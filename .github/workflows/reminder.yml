name: Discord Reminder

on:
  schedule:
    # Daily reminder (UTC+7 = 10:45 UTC)
    - cron: "45 10 * * *"

    # Friday weekly reminder (UTC+7 = 02:00 UTC)
    - cron: "0 2 * * 5"

  workflow_dispatch:

jobs:
  reminder:
    runs-on: ubuntu-latest

    env:
      DAILY_MESSAGE: |
      @everyone
        ‚è∞ **Reminder l√∫c {{TIME}}**
        M·ªçi ng∆∞·ªùi nh·ªõ ƒëi·ªÅn **file report** nh√©!

      WEEKLY_MESSAGE: |
      @everyone
        üö®üö® **BIG REMIND** üö®üö®
        (G·ª≠i l√∫c {{TIME}})
        H√¥m nay l√† **Th·ª© 6**!
        M·ªçi ng∆∞·ªùi nh·ªõ **FULL FILL LOGWORK cho c·∫£ tu·∫ßn** üí™

    steps:
      - name: Send reminder to Discord
        env:
          WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK }}
          CRON_EXPR: ${{ github.event.schedule }}
        run: |
          # Ch·ªâ g·ª≠i khi ch·∫°y theo schedule (kh√¥ng g·ª≠i khi Run workflow)
          if [ "${{ github.event_name }}" != "schedule" ]; then
            echo "Manual run detected, skip sending."
            exit 0
          fi

          # L·∫•y gi·ªù VN (UTC+7)
          TIME_VN=$(TZ=Asia/Ho_Chi_Minh date '+%H:%M')

          if [ "$CRON_EXPR" = "0 2 * * 5" ]; then
            MESSAGE="$WEEKLY_MESSAGE"
          else
            MESSAGE="$DAILY_MESSAGE"
          fi

          # Thay {{TIME}} b·∫±ng gi·ªù th·ª±c t·∫ø
          MESSAGE="${MESSAGE//\{\{TIME\}\}/$TIME_VN}"

          jq -n --arg content "$MESSAGE" \
            '{content: $content}' \
            | curl -s -X POST \
                -H "Content-Type: application/json" \
                -d @- \
                "$WEBHOOK_URL"
